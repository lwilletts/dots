#!/bin/zsh
#
# /home/fyr/.dots/bin/servmount

usage() {
    base=$(basename "$0")

    cat >&2 << EOF
Usage:
    $base
EOF

    test $# -eq 0 || exit "$1"
}

main() {
    host="phosphor"
    mount_dir="/mnt/pool"

    if nc -zw 1 "$host" 22 2> /dev/null; then
        # requires /etc/fstab entry
        test -z "$(mount -l | awk '$0~s' s="$mount_dir")" && \
            mount ${mount_dir} && printf '%s\n' "Mounted ${mount_dir} successfully."
    else
        test -n "$(mount -l | awk '$0~s' s="$mount_dir")" && \
            umount -f -l "${mount_dir}" && \
            printf '%s\n' "Unmounted ${mount_dir} successfully."
    fi
}

main "$@"
