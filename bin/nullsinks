#!/bin/sh
#
# nullsinks

usage() {
    base=$(basename "$0")

    cat >&2 << EOF
Usage:
    $base
EOF

    [ $# -eq 0 ] || exit "$1"
}

pulse() {
    pactl load-module module-null-sink sink_name=gamesink sink_properties='device.description="Game Sink"'
    pactl load-module module-null-sink sink_name=mediasink sink_properties='device.description="Media Sink"'
    pactl load-module module-null-sink sink_name=discordsink sink_properties='device.description="Discord Sink"'
    pactl load-module module-null-sink sink_name=vodsink sink_properties='device.description="VOD Sink"'

    pactl load-module module-loopback source=gamesink.monitor sink=vodsink latency_msec=30 sink_input_properties='media.name="VOD Game Loopback"'
    pactl load-module module-loopback source=discordsink.monitor sink=vodsink latency_msec=30 sink_input_properties='media.name="VOD Discord Loopback"'

    pactl load-module module-loopback source=gamesink.monitor sink=alsa_output.usb-FiiO_DigiHug_USB_Audio-01.analog-stereo latency_msec=30 sink_input_properties='media.name="Fiio Game Loopback"'
    pactl load-module module-loopback source=mediasink.monitor sink=alsa_output.usb-FiiO_DigiHug_USB_Audio-01.analog-stereo latency_msec=30 sink_input_properties='media.name="Fiio Media Loopback"'
    pactl load-module module-loopback source=discordsink.monitor sink=alsa_output.usb-FiiO_DigiHug_USB_Audio-01.analog-stereo latency_msec=30 sink_input_properties='media.name="Fiio Discord Loopback"'
}

main() {
    pw-loopback -C "Game Sink" -P "Fiio E10 Analog Stereo" --playback-props "media.name=Game" &
    pw-loopback -C "Media Sink" -P "Fiio E10 Analog Stereo" --playback-props "media.name=Media" &
    pw-loopback -C "Discord Sink" -P "Fiio E10 Analog Stereo" --playback-props "media.name=Discord" &
}

main "$@"
