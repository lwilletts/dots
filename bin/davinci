#!/bin/sh
#
# davinci

usage() {
    base=$(basename "$0")

    cat >&2 << EOF
Usage:
    $base
EOF

    [ $# -eq 0 ] || exit "$1"
}

main() {
    resolveconf="$XDG_CONFIG_HOME/resolve"
    test -d "$resolveconf" || mkdir -p "$resolveconf"

    cd "$resolveconf" || return 1

    case $1 in
        noquiet)
            HOME="$resolveconf" __NV_PRIME_RENDER_OFFLOAD=1 \
                                __VK_LAYER_NV_optimus=NVIDIA_only \
                                __GLX_VENDOR_LIBRARY_NAME=nvidia \
                                /opt/resolve/bin/resolve
            ;;
        *)
            HOME="$resolveconf" __NV_PRIME_RENDER_OFFLOAD=1 \
                                __VK_LAYER_NV_optimus=NVIDIA_only \
                                __GLX_VENDOR_LIBRARY_NAME=nvidia \
                                /opt/resolve/bin/resolve > /dev/null 2>&1
            ;;
    esac

}

main "$@"
