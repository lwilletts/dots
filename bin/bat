#!/bin/sh
#
# bat

manual() {
    BAT="/sys/class/power_supply/BAT0"
    test -d "$BAT" || return 0

    CHR="$(cat "$BAT/charge_now")"
    MAX="$(cat "$BAT/charge_full")"
    STATUS="$(cat "$BAT/status")"
    PERCENT="$(printf '%.2f\n' "$(echo "$CHR/$MAX*100" | bc -l)")"
}

acpidata() {
    ACPINFO="$(acpi -b)"
    PERCENT="$(printf '%s\n' "$ACPINFO" | cut -d\  -f 4 | cut -d% -f 1)"
    STATUS="$(printf '%s\n' "$ACPINFO" | cut -d\  -f 3 | cut -d, -f 1)"
}

case "$1" in
    manual) manual   ;;
    acpi)   acpidata ;;
    *)      acpidata ;;
esac

case "$STATUS" in
    "Charging")
        printf '%s\n' "$PERCENT% ⮒"
        ;;
    "Discharging")
        test "$(echo "$PERCENT <= 40" | bc)" -eq 1 && printf '%s\n' "$PERCENT% ⮐"
        test "$(echo "$PERCENT >= 80" | bc)" -eq 1 && printf '%s\n' "$PERCENT% ⮎"
        test "$(echo "$PERCENT < 80" | bc)" -eq 1 && {
            test "$(echo "$PERCENT >= 60" | bc)" -eq 1 && {
                printf '%s\n' "$PERCENT% ⮏"
            }
        }
        ;;
esac
