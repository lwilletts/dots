#!/bin/sh
#
# wake

GPIO="/sys/class/gpio"
pin=23

test ! -d "$GPIO" && {
    printf '%s\n' "No gpio directory found."
    exit 1
}

power() {
    # initialise pin
    test ! -d "$GPIO/gpio$pin/" && printf '%s\n' "$pin" > "$GPIO/export"

    # change direction of pin briefly to close power circuit
    printf '%s\n' "out" > "$GPIO/gpio$pin/direction"
    sleep 0.2
    printf '%s\n' "in" > "$GPIO/gpio$pin/direction"
}

shut() {
    # initialise pin
    test ! -d "$GPIO/gpio$pin/" && printf '%s\n' "$pin" > "$GPIO/export"

    # change direction of pin to close power circuit for longer
    printf '%s\n' "out" > "$GPIO/gpio$pin/direction"
    sleep 3
    printf '%s\n' "in" > "$GPIO/gpio$pin/direction"
}

case "$1" in
    on)
        power
        ;;
    off)
        shut
        ;;
esac
